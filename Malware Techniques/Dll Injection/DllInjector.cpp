#include <Windows.h>
#include <stdio.h>

int main(int argc, char* argv[]) {

	int targetProcessId = atoi(argv[1]);
	char dllPath[72] = "C:\\Users\\Public\\IATHooking.dll";
	printf("Injecting %s in to process %d\n", dllPath, targetProcessId);

	HANDLE targetProcess = OpenProcess(PROCESS_ALL_ACCESS, false, targetProcessId);

	if (targetProcess == NULL) {
		printf("ERROR! Open target process operation failed!\n");
	}

	LPVOID dllPathAddress = VirtualAllocEx(targetProcess, NULL, strlen(dllPath) + 1, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);

	if (dllPathAddress == NULL) {
		printf("ERROR! Memory allocation operation failed!\n");
	}

	WriteProcessMemory(targetProcess, dllPathAddress, (LPCVOID)dllPath, strlen(dllPath) + 1, NULL);
	HMODULE kernelHandle = GetModuleHandleA("Kernel32");
	LPVOID loadLibraryAddress = GetProcAddress(kernelHandle, "LoadLibraryA");
	
	HANDLE injectedDllThread = CreateRemoteThread(targetProcess, NULL, 0, (LPTHREAD_START_ROUTINE)loadLibraryAddress, dllPathAddress, 0, NULL);
	if (injectedDllThread == NULL) {
		printf("ERROR! threat cration failed!\n");
	}
	
	return 0;
	
}